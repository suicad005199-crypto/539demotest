<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>539 ç©©å®šç­–ç•¥å›æ¸¬èˆ‡é æ¸¬</title>
<style>
body { font-family: Arial; padding: 20px; }
table { border-collapse: collapse; margin-top: 10px; }
td, th { border: 1px solid #ccc; padding: 6px; text-align: center; }
.hit2 { background: #d0f0d0; }
.hit3 { background: #90e090; font-weight: bold; }
.reject { color: #b00000; font-weight: bold; }
</style>
</head>
<body>

<h2>539 ç©©å®šç­–ç•¥å›æ¸¬ç³»çµ±ï¼ˆå¯é‡ç¾ï¼‰</h2>
<input type="file" id="csvFile" accept=".csv">
<button onclick="run()">åŸ·è¡Œå›æ¸¬</button>

<div id="summary"></div>
<div id="next"></div>
<div id="stable"></div>

<script>
function parseCSV(text){
  return text.trim().split('\n').slice(1).map(l=>{
    const p=l.split(',');
    return {date:p[0], nums:p.slice(1).map(Number)};
  });
}

function run(){
  const f=document.getElementById('csvFile').files[0];
  if(!f) return alert('è«‹ä¸Šå‚³ CSV');
  const r=new FileReader();
  r.onload=e=>simulate(parseCSV(e.target.result));
  r.readAsText(f);
}

function simulate(data){
  let hit2=0, hit3=0;
  const total=data.length-10;
  const comboScore={};

  for(let i=10;i<data.length;i++){
    const hist=data.slice(i-10,i);
    const target=data[i].nums;

    const freq={}, lastSeen={};
    hist.forEach((d,idx)=>d.nums.forEach(n=>{
      freq[n]=(freq[n]||0)+1;
      lastSeen[n]=idx;
    }));

    const hot=Object.keys(freq).filter(n=>freq[n]>=2).map(Number)
      .sort((a,b)=>freq[b]-freq[a]);

    const gap=Object.keys(lastSeen)
      .filter(n=>10-lastSeen[n]>=10)
      .map(Number)
      .sort((a,b)=>(10-lastSeen[b])-(10-lastSeen[a]));

    if(hot.length<3 || gap.length<2) continue;

    const pick=[hot[0],hot[1],hot[2],gap[0],gap[1]].sort((a,b)=>a-b);
    const key=pick.join('-');

    const h=pick.filter(n=>target.includes(n)).length;
    if(h>=2) hit2++;
    if(h>=3) hit3++;

    comboScore[key]=(comboScore[key]||0)+(h>=2?1:0);
  }

  const rate2=hit2/total*100;
  const rate3=hit3/total*100;

  document.getElementById('summary').innerHTML=`
  <h3>å›æ¸¬çµæœ</h3>
  å¯å›æ¸¬æœŸæ•¸ï¼š${total}<br>
  â‰¥2ï¼š${rate2.toFixed(1)}%<br>
  â‰¥3ï¼š${rate3.toFixed(1)}%
  `;

  if(rate2<70){
    document.getElementById('next').innerHTML='';
    document.getElementById('stable').innerHTML=
      `<div class="reject">âŒ â‰¥2 æœªé” 70%ï¼Œç­–ç•¥æ·˜æ±°</div>`;
    return;
  }

  // æœ€ç©©å‰ä¸‰çµ„
  const stableTop=Object.entries(comboScore)
    .sort((a,b)=>b[1]-a[1])
    .slice(0,3);

  document.getElementById('stable').innerHTML=`
  <h3>ç³»çµ±æœ€ç©©å‰ä¸‰çµ„ï¼ˆæ­·å² â‰¥2 å‘½ä¸­æ¬¡æ•¸æœ€é«˜ï¼‰</h3>
  ${stableTop.map((c,i)=>`#${i+1} [${c[0].replaceAll('-', ' ')}]ï¼ˆå‘½ä¸­ ${c[1]} æ¬¡ï¼‰`).join('<br>')}
  `;

  // ä¸‹æœŸé æ¸¬ï¼ˆå›ºå®šé‚è¼¯ï¼‰
  const lastHist=data.slice(-10);
  const f2={};
  lastHist.forEach(d=>d.nums.forEach(n=>f2[n]=(f2[n]||0)+1));
  const hotNow=Object.keys(f2).filter(n=>f2[n]>=2).map(Number)
    .sort((a,b)=>f2[b]-f2[a]);

  const nextPick=hotNow.slice(0,5).sort((a,b)=>a-b);

  document.getElementById('next').innerHTML=`
  <h3>ğŸ“Œ ä¸‹æœŸé æ¸¬ç‰Œçµ„ï¼ˆç©©å®šç›¤ï¼‰</h3>
  [${nextPick.join(' ')}]
  `;
}
</script>
</body>
</html>
