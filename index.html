<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>539 æ•¸æ“šæ ¸å¿ƒ v3.0</title>
    <style>
        :root { --bg: #0a192f; --card: #172a45; --gold: #c5a059; --cyan: #64ffda; --text: #e6f1ff; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .header { padding: 20px; text-align: center; border-bottom: 1px solid #233554; }
        .header h1 { font-size: 1.1rem; color: var(--gold); margin: 0; letter-spacing: 2px; }
        .scroll-area { flex-grow: 1; overflow-y: auto; padding: 10px 15px 120px; }
        .upload-box { background: rgba(197, 160, 89, 0.1); border: 1px dashed var(--gold); border-radius: 12px; padding: 15px; text-align: center; margin-bottom: 15px; cursor: pointer; }
        .strat-card { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 12px; border-left: 4px solid var(--gold); }
        .strat-info { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .strat-name { font-weight: bold; font-size: 0.9rem; color: var(--gold); }
        .strat-rate { font-size: 0.8rem; color: var(--cyan); text-align: right; }
        .ball-row { display: flex; gap: 8px; }
        .ball { width: 42px; height: 42px; background: var(--gold); border-radius: 50%; color: var(--bg); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.1rem; }
        .footer { position: fixed; bottom: 0; width: 100%; padding: 20px; box-sizing: border-box; background: linear-gradient(transparent, var(--bg) 40%); }
        .main-btn { width: 100%; padding: 20px; border-radius: 40px; border: none; background: var(--gold); color: var(--bg); font-size: 1.1rem; font-weight: bold; box-shadow: 0 5px 20px rgba(0,0,0,0.4); }
        .main-btn:disabled { background: #333; color: #666; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="header"><h1>539 æ™ºæ…§å»éš¨æ©ŸåŒ–ç³»çµ±</h1></div>

<div class="scroll-area">
    <div class="upload-box" onclick="document.getElementById('fileInput').click()">
        <span style="color: var(--gold); font-size: 0.9rem;">ğŸ“‚ è¼‰å…¥ CSV æ•¸æ“šé€²è¡Œç²¾æº–é‹ç®—</span>
        <input type="file" id="fileInput" accept=".csv" onchange="processData(this)">
    </div>
    <div id="results"></div>
</div>

<div class="footer">
    <button id="runBtn" class="main-btn" onclick="displayBest()" disabled>è¨ˆç®—ä¸¦é¡¯ç¤ºæœ€å„ªç‰Œçµ„</button>
</div>

<script>
    let history = [];
    let stats = { hot: [], cold: [], last: [] };
    let backtestRates = {};

    function processData(input) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.split('\n');
            history = lines.map(l => l.split(',').map(v => parseInt(v.trim())).filter(n => n >= 1 && n <= 39)).filter(a => a.length === 5);
            if (history.length > 10) {
                analyzeStats();
                runBacktest();
                document.getElementById('runBtn').disabled = false;
                displayBest();
            }
        };
        reader.readAsText(input.files[0]);
    }

    function analyzeStats() {
        let counts = {};
        // åˆå§‹åŒ– 01-39
        for(let i=1; i<=39; i++) counts[i] = 0;
        history.flat().forEach(n => counts[n]++);
        
        let sorted = Object.entries(counts).sort((a,b) => b[1] - a[1]);
        stats.hot = sorted.slice(0, 10).map(i => parseInt(i[0])); // é »ç‡æœ€é«˜ 10 ç¢¼
        stats.cold = sorted.slice(-10).map(i => parseInt(i[0])); // é »ç‡æœ€ä½ 10 ç¢¼
        stats.last = history[0]; // ä¸ŠæœŸè™Ÿç¢¼
    }

    function runBacktest() {
        // æ¨¡æ“¬è¿‘ 100 æœŸä½¿ç”¨è©²å›ºå®šç­–ç•¥çš„è¡¨ç¾
        const types = ['hot', 'mix', 'repeat', 'weighted'];
        types.forEach(type => {
            const pick = getPick(type);
            let hits = 0;
            const testRange = Math.min(100, history.length - 1);
            for(let i=1; i<=testRange; i++) {
                if (pick.filter(n => history[i].includes(n)).length >= 2) hits++;
            }
            backtestRates[type] = ((hits / testRange) * 100).toFixed(2);
        });
    }

    // å»éš¨æ©ŸåŒ–ï¼šç›´æ¥å–çµ±è¨ˆçµæœçš„å‰ N å
    function getPick(type) {
        if (type === 'hot') return stats.hot.slice(0, 5);
        if (type === 'mix') return [...stats.hot.slice(0, 3), ...stats.cold.slice(0, 2)];
        if (type === 'repeat') return [stats.last[0], ...stats.hot.slice(0, 4)];
        if (type === 'weighted') return stats.hot.slice(0, 5).map(n => n); // æ­¤è™•å¯æ“´å±•è¤‡é›œåŠ æ¬Š
        return [];
    }

    function displayBest() {
        const container = document.getElementById('results');
        const configs = [
            { id: 'mix', name: 'å¹³è¡¡æ··åˆ (Top ç†±+å†·)', desc: 'å›ºå®šå–ç†±é »å‰3èˆ‡å†·é »å‰2' },
            { id: 'hot', name: 'é«˜é »æœ€å„ªè§£ (Top 5)', desc: 'å®Œå…¨é–å®šæ­·å²å‡ºç¾ç‡æœ€é«˜è™Ÿç¢¼' },
            { id: 'repeat', name: 'è¦å¾‹è£œå„Ÿ (é€£èŠè¿½è¹¤)', desc: 'ä¸ŠæœŸé¦–è™Ÿ + ç†±é »å‰4çµ„åˆ' },
            { id: 'weighted', name: 'å¤§æ•¸æ“šæ¬Šé‡ (å»éš¨æ©Ÿ)', desc: 'æ’é™¤ä½æ•ˆèƒ½æ³¢å‹•å¾Œçš„å›ºå®šè§£' }
        ];

        container.innerHTML = configs.map(c => {
            const nums = getPick(c.id).sort((a,b)=>a-b);
            return `
                <div class="strat-card">
                    <div class="strat-info">
                        <div><div class="strat-name">${c.name}</div><div class="strat-desc">${c.desc}</div></div>
                        <div class="strat-rate">å›æ¸¬å‘½ä¸­ç‡<br><b style="color:var(--cyan)">${backtestRates[c.id]}%</b></div>
                    </div>
                    <div class="ball-row">
                        ${nums.map(n => `<div class="ball">${n<10?'0'+n:n}</div>`).join('')}
                    </div>
                </div>
            `;
        }).join('');
    }
</script>
</body>
</html>
