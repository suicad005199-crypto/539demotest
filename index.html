<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>539 â‰¥2 æ˜Ÿ A/B ç­–ç•¥å°ç…§</title>

<style>
body { font-family: system-ui; background:#f8fafc; padding:20px; color:#1e293b }
.container { max-width:1100px; margin:auto }
h2,h3 { margin:10px 0 }

.card { background:#fff; border-radius:10px; padding:15px; margin-bottom:15px;
        box-shadow:0 1px 3px rgba(0,0,0,.1) }

button { padding:6px 16px; background:#2563eb; color:#fff; border:0; border-radius:6px }

table { width:100%; border-collapse:collapse; font-size:14px }
th,td { padding:8px; border-bottom:1px solid #e5e7eb; vertical-align:top }

.num { display:inline-block; padding:2px 6px; margin:2px;
       border:1px solid #cbd5e1; border-radius:4px; font-family:monospace }
.hit { background:#22c55e; color:#fff; border-color:#16a34a }
.draw { background:#64748b; color:#fff; border-color:#475569 }

.panel { max-height:360px; overflow:auto }
.badge { display:inline-block; padding:2px 8px; border-radius:6px;
         background:#e5e7eb; font-size:12px; margin-left:6px }
.win { background:#22c55e; color:#fff }
.warn { color:#dc2626; font-weight:bold }
</style>
</head>

<body>
<div class="container">

<h2>ğŸ“Š 539 â‰¥2 æ˜Ÿ A/B ç­–ç•¥å°ç…§ç³»çµ±</h2>

<input type="file" id="csv" accept=".csv">
<button onclick="run()">åŸ·è¡Œå›æ¸¬</button>

<!-- æ–°å¢ï¼šè³‡æ–™è®€å–ç‹€æ…‹ -->
<div id="dataInfo" class="card"></div>

<div id="summary" class="card"></div>
<div id="next" class="card"></div>

<div class="card">
<h3>å›æ¸¬ Logï¼ˆé–‹ç vs é æ¸¬ï¼‰</h3>
<div id="log" class="panel"></div>
</div>

<div class="card" id="logic"></div>

</div>

<script>
/* ---------- CSV ---------- */
function parseCSV(t){
  return t.trim().split('\n').slice(1).map(r=>{
    const p=r.split(',');
    return {date:p[0], nums:p.slice(1).map(Number)};
  }).filter(r=>r.nums.length===5);
}

function run(){
  const f=document.getElementById('csv').files[0];
  if(!f) return alert('è«‹ä¸Šå‚³ CSV');
  const r=new FileReader();
  r.onload=e=>{
    const data=parseCSV(e.target.result);
    renderDataInfo(data);
    simulate(data);
  };
  r.readAsText(f);
}

/* ---------- è³‡æ–™è³‡è¨Š Panel ---------- */
function renderDataInfo(data){
  const total=data.length;
  const usable=Math.max(0,total-10);
  document.getElementById('dataInfo').innerHTML=`
    <h3>ğŸ“ CSV è³‡æ–™ç‹€æ…‹</h3>
    åŸå§‹è³‡æ–™ç­†æ•¸ï¼š<strong>${total}</strong><br>
    å¯å›æ¸¬æœŸæ•¸ï¼ˆæ‰£é™¤å‰ 10 æœŸï¼‰ï¼š<strong>${usable}</strong><br>
    ${usable<=0?'<span class="warn">âš  è³‡æ–™ä¸è¶³ï¼Œç„¡æ³•å›æ¸¬</span>':''}
  `;
}

/* ---------- Pool ---------- */
function poolA(data,i){
  const hist=data.slice(i-10,i);
  const freq={};
  hist.forEach(d=>d.nums.forEach(n=>freq[n]=(freq[n]||0)+1));
  return Object.keys(freq).filter(n=>freq[n]>=2).map(Number).slice(0,20);
}

function poolB(data,i){
  const hist=data.slice(i-10,i);
  const freq={};
  hist.forEach(d=>d.nums.forEach(n=>freq[n]=(freq[n]||0)+1));
  let hot=Object.keys(freq).filter(n=>freq[n]>=2).map(Number);
  for(let n=1; hot.length<20 && n<=39; n++){
    if(!hot.includes(n)) hot.push(n);
  }
  return hot;
}

/* ---------- Picksï¼ˆå›ºå®šç”Ÿæˆï¼‰ ---------- */
function genPicks(pool){
  const picks=[];
  let idx=0;
  while(picks.length<5){
    let c=[];
    for(let k=0;k<pool.length && c.length<5;k++){
      const n=pool[(idx+k*2)%pool.length];
      if(!c.includes(n)) c.push(n);
    }
    idx++;
    c.sort((a,b)=>a-b);
    if(!picks.some(p=>p.join()==c.join())) picks.push(c);
  }
  return picks;
}

/* ---------- å›æ¸¬ ---------- */
function simulate(data){
  if(data.length<=10) return;

  let stat={ A:{hit2:0,total:0}, B:{hit2:0,total:0} };
  let rows='';

  for(let i=10;i<data.length;i++){
    const draw=data[i].nums;

    ['A','B'].forEach(s=>{
      const pool=s==='A'?poolA(data,i):poolB(data,i);
      if(pool.length<5) return;
      const picks=genPicks(pool);
      let best=0;
      picks.forEach(p=>{
        best=Math.max(best,p.filter(n=>draw.includes(n)).length);
      });
      if(best>=2) stat[s].hit2++;
      stat[s].total++;
    });

    const showPicks=genPicks(poolA(data,i));
    rows=`
    <tr>
      <td>${data[i].date}</td>
      <td>${draw.map(n=>`<span class="num draw">${n}</span>`).join('')}</td>
      <td>${showPicks.map(p=>`<div>${p.map(n=>
        `<span class="num ${draw.includes(n)?'hit':''}">${n}</span>`
      ).join('')}</div>`).join('')}</td>
    </tr>`+rows;
  }

  const rateA=(stat.A.hit2/stat.A.total*100).toFixed(1);
  const rateB=(stat.B.hit2/stat.B.total*100).toFixed(1);
  const winner=rateA>=rateB?'A':'B';

  document.getElementById('summary').innerHTML=`
    <h3>ç­–ç•¥ â‰¥2 æ˜Ÿå‘½ä¸­ç‡</h3>
    A ç­–ç•¥ï¼š${rateA}% ${winner==='A'?'<span class="badge win">å‹å‡º</span>':''}<br>
    B ç­–ç•¥ï¼š${rateB}% ${winner==='B'?'<span class="badge win">å‹å‡º</span>':''}
  `;

  document.getElementById('log').innerHTML=
    `<table>
      <tr><th>æ—¥æœŸ</th><th>é–‹ç</th><th>A ç­–ç•¥é æ¸¬</th></tr>
      ${rows}
    </table>`;

  renderNext(data,winner);
  renderLogic(rateA,rateB,winner);
}

/* ---------- ä¸‹æœŸ ---------- */
function renderNext(data,w){
  const pool=w==='A'?poolA(data,data.length):poolB(data,data.length);
  const picks=genPicks(pool);
  document.getElementById('next').innerHTML=`
    <h3>ğŸ“Œ ä¸‹æœŸé æ¸¬ï¼ˆæ¡ç”¨ ${w} ç­–ç•¥ï¼‰</h3>
    ${picks.map((p,i)=>`<div>çµ„${i+1}ï¼š
      ${p.map(n=>`<span class="num">${n}</span>`).join('')}</div>`).join('')}
  `;
}

/* ---------- é‚è¼¯ ---------- */
function renderLogic(a,b,w){
  document.getElementById('logic').innerHTML=`
    <h3>ç­–ç•¥é‚è¼¯èªªæ˜</h3>
    <ul>
      <li>Aï¼šç´”ç†±è™Ÿè¦†è“‹ï¼Œå£“ä½è®Šç•°ï¼Œè¿½æ±‚ â‰¥2 ç©©å®šç‡</li>
      <li>Bï¼šç†±è™Ÿ + è¼ªå‹•è£œä½ï¼Œæå‡æ¶µè“‹é¢</li>
      <li>åƒ…è©•ä¼° â‰¥2 æ˜Ÿï¼Œä¸è¨ˆ 3 / 4 æ˜Ÿ</li>
      <li>è‡ªå‹•é¸ç”¨ â‰¥2 å‘½ä¸­ç‡è¼ƒé«˜ç­–ç•¥ï¼ˆæœ¬æ¬¡ï¼š${w}ï¼‰</li>
    </ul>
  `;
}
</script>
</body>
</html>
