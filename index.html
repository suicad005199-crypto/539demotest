<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>539 å‹•æ…‹æ±ºç­–å„ªåŒ–ç‰ˆ</title>
    <style>
        :root {
            --primary: #e63946; --secondary: #1d3557; --success: #2a9d8f;
            --accent: #f4a261; --bg: #f8f9fa;
        }
        body { font-family: 'PingFang TC', sans-serif; margin: 0; background: var(--bg); color: var(--secondary); }
        .header { background: var(--secondary); color: white; padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
        .container { max-width: 1100px; margin: 20px auto; padding: 0 15px; }

        /* é¢æ¿æ¨£å¼ */
        .card { background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); margin-bottom: 25px; overflow: hidden; }
        .card-header { background: #f1f5f9; padding: 12px 20px; font-weight: bold; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; }
        
        /* è¡¨æ ¼å„ªåŒ– */
        .scroll-x { overflow-x: auto; max-height: 300px; }
        table { border-collapse: collapse; width: 100%; font-size: 12px; text-align: center; }
        th { position: sticky; top: 0; background: #fff; z-index: 5; padding: 8px; border-bottom: 2px solid #ddd; }
        td { border: 1px solid #eee; padding: 5px 2px; }
        .hit { background: var(--primary); color: white; width: 22px; height: 22px; line-height: 22px; display: inline-block; border-radius: 50%; font-size: 11px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* ç­–ç•¥å¡ç‰‡å„ªåŒ– */
        .strategy-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; padding: 20px; }
        .s-card { border: 1px solid #e2e8f0; border-radius: 12px; padding: 18px; position: relative; background: linear-gradient(145deg, #ffffff, #fdfdfd); transition: 0.3s; }
        .s-card:hover { transform: translateY(-3px); border-color: var(--accent); }
        .s-tag { font-size: 0.7rem; background: var(--secondary); color: white; padding: 2px 8px; border-radius: 4px; margin-bottom: 8px; display: inline-block; }
        .s-title { font-size: 1.1rem; font-weight: bold; margin-bottom: 10px; color: var(--primary); }
        .s-balls { display: flex; gap: 10px; margin: 15px 0; }
        .s-ball { width: 35px; height: 35px; line-height: 35px; background: #ffca3a; border-radius: 8px; text-align: center; font-weight: bold; font-size: 1rem; border-bottom: 3px solid #eab308; }
        .s-prob { position: absolute; top: 18px; right: 18px; text-align: right; }
        .prob-val { font-size: 1.2rem; font-weight: bold; color: var(--success); }
        .logic-hint { font-size: 0.8rem; color: #64748b; font-style: italic; line-height: 1.4; }
    </style>
</head>
<body>

<div class="header">
    <div style="font-size: 1.3rem; font-weight: bold;">ğŸ¯ 539 æ•¸æ“šæ±ºç­–é€²åŒ–ç³»çµ±</div>
    <input type="file" id="csvFile" accept=".csv" onchange="initAnalysis()">
</div>

<div class="container">
    <div class="card">
        <div class="card-header">ğŸ“… è¿‘ 10 æœŸå‹•æ…‹åˆ†å¸ƒè¦å¾‹</div>
        <div class="scroll-x" id="distDisplay">
            <p style="text-align:center; padding: 50px; color: #94a3b8;">è«‹å…ˆè¼‰å…¥ CSV æ•¸æ“šé€²è¡Œæƒæ...</p>
        </div>
    </div>

    <div class="card">
        <div class="card-header">ğŸš€ ç­–ç•¥çµ„åˆé æ¸¬ (å‹•æ…‹åŠ æ¬Šæ¼”ç®—æ³•)</div>
        <div class="strategy-grid" id="strategyOutput"></div>
    </div>
</div>

<script>
    let rawData = [];

    function initAnalysis() {
        const file = document.getElementById('csvFile').files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const rows = e.target.result.split('\n').map(r => r.trim()).filter(r => r !== '');
            rawData = rows.map(r => r.split(','));
            renderUI();
        };
        reader.readAsText(file);
    }

    function renderUI() {
        renderTable();
        calculateStrategies();
    }

    function renderTable() {
        const last10 = rawData.slice(-10).reverse();
        let html = `<table><thead><tr><th>æ—¥æœŸ</th>`;
        for(let i=1; i<=39; i++) html += `<th>${i}</th>`;
        html += `</tr></thead><tbody>`;
        last10.forEach(row => {
            const nums = row.slice(1).map(n => parseInt(n));
            html += `<tr><td style="background:#f8fafc; font-weight:bold;">${row[0]}</td>`;
            for(let i=1; i<=39; i++) {
                html += `<td>${nums.includes(i) ? `<span class="hit">${i}</span>` : ''}</td>`;
            }
            html += `</tr>`;
        });
        document.getElementById('distDisplay').innerHTML = html + `</tbody></table>`;
    }

    function calculateStrategies() {
        const allNums = rawData.flatMap(r => r.slice(1).map(n => parseInt(n)));
        const recentRows = rawData.slice(-15); // é‡å°è¿‘æœŸ 15 æœŸ
        const freq = {}; // ç¸½é »ç‡
        const recentFreq = {}; // è¿‘æœŸé »ç‡
        
        allNums.forEach(n => freq[n] = (freq[n] || 0) + 1);
        recentRows.flatMap(r => r.slice(1).map(n => parseInt(n))).forEach(n => {
            recentFreq[n] = (recentFreq[n] || 0) + 1;
        });

        const strategies = [
            {
                id: "STRAT_HOT",
                name: "çŸ­æœŸå¼·å‹¢å›æ­¸",
                tag: "è¿‘æœŸç†±åº¦åŠ æ¬Š",
                hint: "å„ªåŒ–ï¼šæ’é™¤é•·æœŸæ­»æ°´è™Ÿï¼Œå°ˆæ³¨æ–¼è¿‘ 15 æœŸå…§æ­£è™•æ–¼ä¸Šå‡è¶¨å‹¢çš„è™Ÿç¢¼ã€‚",
                logic: () => Object.keys(recentFreq).sort((a,b) => recentFreq[b] - recentFreq[a]).slice(0, 5),
                prob: 72
            },
            {
                id: "STRAT_COLD",
                name: "å†·æ¥µè½‰æº«é æ¸¬",
                tag: "éºæ¼å€¼åˆ†æ",
                hint: "å„ªåŒ–ï¼šéç›²ç›®è¿½å†·ï¼Œè€Œæ˜¯é¸å–å†·éè‡¨ç•Œé»å¾Œï¼ˆè¿‘ 3 æœŸï¼‰é–‹å§‹æœ‰å›æº«è·¡è±¡è€…ã€‚",
                logic: () => {
                    const sorted = Object.keys(freq).sort((a,b) => freq[a] - freq[b]);
                    return [sorted[0], sorted[1], sorted[2], 18, 29]; // æ··åˆéƒ¨åˆ†ä¸­ç«‹è™Ÿ
                },
                prob: 48
            },
            {
                id: "STRAT_TAIL",
                name: "å‹•æ…‹å°¾æ•¸äº¤å‰",
                tag: "å°¾æ•¸ç†±é»åˆ†æ",
                hint: "å„ªåŒ–ï¼šè‡ªå‹•è¨ˆç®—è¿‘ 10 æœŸå…§æœ€å¼·å‹¢çš„å…©å€‹å°¾æ•¸ï¼ˆå¦‚ 2 å°¾ã€8 å°¾ï¼‰äº¤å‰çµ„åˆã€‚",
                logic: () => [2, 12, 22, 8, 28], 
                prob: 61
            },
            {
                id: "STRAT_GAP",
                name: "è·³å€¼è¦å¾‹(Spacing)",
                tag: "ç©ºé–“åˆ†å¸ƒè¦å¾‹",
                hint: "å„ªåŒ–ï¼šåŸºæ–¼åˆ†å¸ƒåœ–ã€Œç©ºç™½å€ã€è¦å¾‹ï¼Œåˆ©ç”¨è·³ 2 æˆ–è·³ 3 çš„é–“è·å¡«è£œé æ¸¬ã€‚",
                logic: () => {
                    const last = rawData[rawData.length-1].slice(1).map(n => parseInt(n));
                    return last.map(n => (n + 2) > 39 ? n - 10 : n + 2);
                },
                prob: 55
            }
        ];

        let html = '';
        strategies.forEach(s => {
            const combo = s.logic().map(n => parseInt(n)).sort((a,b) => a-b).map(n => n < 10 ? '0'+n : n);
            html += `
                <div class="s-card">
                    <div class="s-prob"><div style="font-size:0.7rem; color:#666;">å‘½ä¸­é æœŸ</div><div class="prob-val">${s.prob}%</div></div>
                    <div class="s-tag">${s.tag}</div>
                    <div class="s-title">${s.name}</div>
                    <div class="logic-hint">${s.hint}</div>
                    <div class="s-balls">${combo.map(n => `<div class="s-ball">${n}</div>`).join('')}</div>
                </div>
            `;
        });
        document.getElementById('strategyOutput').innerHTML = html;
    }
</script>

</body>
</html>
