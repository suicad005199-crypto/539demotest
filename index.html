<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>539 å…¨ç­–ç•¥åˆ†æå„€</title>
    <style>
        :root {
            --bg: #0a192f;
            --card: #172a45;
            --gold: #c5a059;
            --cyan: #64ffda;
            --text: #e6f1ff;
        }
        body {
            font-family: -apple-system, sans-serif;
            background-color: var(--bg); color: var(--text);
            margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh;
        }
        .header { padding: 20px; text-align: center; }
        .header h1 { font-size: 1.2rem; color: var(--gold); margin: 0; letter-spacing: 2px; }

        .scroll-area { flex-grow: 1; overflow-y: auto; padding: 10px 15px; }

        .upload-section {
            background: rgba(197, 160, 89, 0.1); border: 1px dashed var(--gold);
            border-radius: 12px; padding: 15px; text-align: center; margin-bottom: 15px;
        }
        
        /* ç­–ç•¥ç‰Œçµ„é¡¯ç¤ºå¡ç‰‡ */
        .strategy-card {
            background: var(--card); border-radius: 16px; padding: 15px;
            margin-bottom: 15px; border-left: 4px solid var(--gold);
        }
        .strat-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 12px; border-bottom: 1px solid #233554; padding-bottom: 8px;
        }
        .strat-title { font-weight: bold; font-size: 0.95rem; color: var(--gold); }
        .strat-rate { font-size: 0.8rem; color: var(--cyan); }

        .ball-row { display: flex; gap: 8px; justify-content: flex-start; }
        .ball {
            width: 42px; height: 42px; background: var(--gold); border-radius: 50%;
            color: var(--bg); display: flex; align-items: center; justify-content: center;
            font-weight: 800; font-size: 1.1rem;
        }

        .footer-nav { padding: 20px; background: var(--bg); }
        .main-btn {
            width: 100%; padding: 18px; border-radius: 35px; border: none;
            background: var(--gold); color: var(--bg); font-size: 1.1rem; font-weight: bold;
        }
        .main-btn:disabled { background: #444; color: #8892b0; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="header">
    <h1>539 å¤šç­–ç•¥é æ¸¬é¢æ¿</h1>
    <div id="status" style="font-size: 0.7rem; color: #8892b0; margin-top: 5px;">è«‹å…ˆä¸Šå‚³æ­·å²æ•¸æ“š</div>
</div>

<div class="scroll-area">
    <div class="upload-section">
        <label style="color: var(--gold); cursor: pointer;">
            ğŸ“‚ é»æ“Šä¸Šå‚³ CSV æ­·å²æª”
            <input type="file" accept=".csv" onchange="initApp(this)">
        </label>
    </div>

    <div id="resultsContainer">
        </div>
</div>

<div class="footer-nav">
    <button id="runBtn" class="main-btn" onclick="generateAll()" disabled>ä¸€æ¬¡ç”Ÿæˆæ‰€æœ‰ç­–ç•¥ç‰Œçµ„</button>
</div>

<script>
    let historyData = [];
    let stats = { hot: [], cold: [] };
    let backtestRates = {};

    function initApp(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.split('\n');
            historyData = lines.map(line => line.split(',').map(v => parseInt(v.trim())).filter(n => n >= 1 && n <= 39)).filter(arr => arr.length === 5);
            
            if (historyData.length > 0) {
                analyzeHistory();
                runGlobalBacktest();
                document.getElementById('status').innerText = `å·²åˆ†æ ${historyData.length} æœŸæ•¸æ“š`;
                document.getElementById('runBtn').disabled = false;
                generateAll(); // åˆå§‹ç”Ÿæˆä¸€æ¬¡
            }
        };
        reader.readAsText(file);
    }

    // è‡ªå‹•å¾ CSV åˆ†æç†±é–€èˆ‡å†·é–€è™Ÿç¢¼
    function analyzeHistory() {
        let counts = {};
        historyData.flat().forEach(num => counts[num] = (counts[num] || 0) + 1);
        let sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
        stats.hot = sorted.slice(0, 12).map(i => parseInt(i[0]));
        stats.cold = sorted.slice(-12).map(i => parseInt(i[0]));
    }

    // é å…ˆè¨ˆç®—å…¨é‡å›æ¸¬å‘½ä¸­ç‡
    function runGlobalBacktest() {
        const types = ['random', 'hot', 'cold', 'mix'];
        types.forEach(t => {
            let hits = 0;
            const simRounds = 100;
            for(let i=0; i<simRounds; i++) {
                const pick = getPick(t);
                historyData.forEach(actual => {
                    if (pick.filter(n => actual.includes(n)).length >= 2) hits++;
                });
            }
            backtestRates[t] = ((hits / (historyData.length * simRounds)) * 100).toFixed(2);
        });
    }

    function getPick(type) {
        const pickRand = (arr, n) => [...arr].sort(() => Math.random() - 0.5).slice(0, n);
        const allNums = Array.from({length: 39}, (_, i) => i + 1);
        
        if (type === 'random') return pickRand(allNums, 5);
        if (type === 'hot') return pickRand(stats.hot, 5);
        if (type === 'cold') return pickRand(stats.cold, 5);
        if (type === 'mix') return [...pickRand(stats.hot, 3), ...pickRand(stats.cold, 2)];
    }

    function generateAll() {
        const container = document.getElementById('resultsContainer');
        container.innerHTML = '';
        const configs = [
            { id: 'random', name: 'éš¨æ©Ÿç­–ç•¥', desc: 'å…¨è™Ÿç¢¼éš¨æ©Ÿåˆ†ä½ˆ' },
            { id: 'hot', name: 'ç†±é–€ç­–ç•¥', desc: 'æ ¹æ“šæ­·å²é«˜é »è™Ÿç¢¼' },
            { id: 'cold', name: 'å†·é–€ç­–ç•¥', desc: 'æ ¹æ“šæ­·å²ä½é »è™Ÿç¢¼' },
            { id: 'mix', name: 'æ··åˆç­–ç•¥ (3+2)', desc: 'ç†±é–€è™Ÿ x3 + å†·é–€è™Ÿ x2' }
        ];

        configs.forEach(conf => {
            const nums = getPick(conf.id).sort((a,b) => a-b);
            const html = `
                <div class="strategy-card">
                    <div class="strat-header">
                        <div>
                            <div class="strat-title">${conf.name}</div>
                            <div style="font-size:0.7rem; color:#8892b0">${conf.desc}</div>
                        </div>
                        <div class="strat-rate">>2æ˜Ÿå›æ¸¬ç‡: ${backtestRates[conf.id]}%</div>
                    </div>
                    <div class="ball-row">
                        ${nums.map(n => `<div class="ball">${n < 10 ? '0'+n : n}</div>`).join('')}
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', html);
        });
    }
</script>

</body>
</html>
