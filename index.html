<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å¿…ä¸­ v2 - æ™ºèƒ½é æ¸¬ç³»çµ±</title>
<style>
/* ===== åŸå§‹ CSS å®Œå…¨æœªä¿®æ”¹ ===== */
:root {
  --primary: #00ff99;
  --secondary: #274c77;
  --danger: #ff6666;
  --warning: #ffcc00;
  --bg-0: #050b15;
  --bg-1: #0f1f38;
  --bg-2: #142b4d;
  --bg-3: #1a355c;
  --bg-4: #203f6e;
  --text-light: #e0f7ff;
}

/* ï¼ˆä¸­é–“ CSS çœç•¥ï¼Œå¯¦éš›è«‹ä¿ç•™ä½ æä¾›çš„å®Œæ•´å…§å®¹ï¼‰ */
/* ===== åŸå§‹ CSS å®Œå…¨æœªä¿®æ”¹ ===== */
</style>
</head>

<body>

<div class="container">
  <!-- ===== åŸå§‹å…§å®¹å®Œå…¨æœªä¿®æ”¹ ===== -->

  <!-- Header -->
  <div class="header">
    <h1>å¿…ä¸­ v2</h1>
    <div class="subtitle">æ™ºèƒ½é æ¸¬åˆ†æç³»çµ± | åŸºæ–¼æ­·å²æ•¸æ“šçš„å¤šç¶­åº¦åˆ†æ</div>
  </div>

  <!-- Panel 1ï¼šæ•¸æ“šå°å…¥ -->
  <div class="panel panel-1">
    <h2>ğŸ“Š æ•¸æ“šå°å…¥å±¤</h2>
    <input type="file" id="csvInput" class="file-input" accept=".csv">
    <div id="csvInfo" class="status"></div>
    <div class="stats-row" id="basicStats" style="display: none;"></div>
  </div>

  <!-- Panel Aï¼šæ™ºèƒ½åˆ†æ -->
  <div class="panel panel-2">
    <h2>ğŸ” æ™ºèƒ½åˆ†æå±¤</h2>
    <button class="btn btn-primary" onclick="runAnalysis()">åŸ·è¡Œæ·±åº¦åˆ†æ</button>
    <div class="loading" id="loadingA">
      <div class="spinner"></div>
      <div>æ­£åœ¨åˆ†ææ•¸æ“š...</div>
    </div>
    <div id="panelA" style="display: none;"></div>
  </div>

  <!-- Panel Bï¼šçµ„åˆé©—è­‰ -->
  <div class="panel panel-3">
    <h2>âœ… çµ„åˆé©—è­‰å±¤</h2>
    <input type="text" id="verifyInput" class="text-input">
    <button class="btn" onclick="runVerify()">åˆ†æçµ„åˆ</button>
    <div id="panelB" style="display: none;"></div>
  </div>

  <!-- Panel Cï¼šé æ¸¬ç”Ÿæˆ -->
  <div class="panel panel-4">
    <h2>ğŸ¯ é æ¸¬ç”Ÿæˆå±¤</h2>
    <button class="btn btn-primary" onclick="generatePrediction()">ç”Ÿæˆé æ¸¬çµ„åˆ</button>
    <div class="loading" id="loadingC">
      <div class="spinner"></div>
      <div>æ­£åœ¨ç”Ÿæˆé æ¸¬...</div>
    </div>
    <div id="panelC" style="display: none;"></div>
  </div>

  <!-- ================= æ–°å¢ Panel Dï¼šå›æ¸¬æ¨¡æ“¬ï¼ˆä¸å½±éŸ¿åŸé‚è¼¯ï¼‰ ================= -->
  <div class="panel panel-0">
    <h2>ğŸ§ª å›æ¸¬æ¨¡æ“¬å±¤</h2>
    <button class="btn btn-primary" onclick="runBacktest()">åŸ·è¡Œå®Œæ•´å›æ¸¬</button>

    <div class="loading" id="loadingBacktest">
      <div class="spinner"></div>
      <div>æ­£åœ¨é€²è¡Œé€æœŸå›æ¸¬...</div>
    </div>

    <div id="panelBacktest" style="display:none;">
      <div class="box">
        <div class="box-title">ğŸ“Š å›æ¸¬ç¸½è¦½</div>
        <div id="backtestSummary"></div>
      </div>

      <div class="box">
        <div class="box-title">ğŸ“‹ é€æœŸå‘½ä¸­ç´€éŒ„</div>
        <div style="max-height:300px; overflow:auto;">
          <table style="width:100%; font-size:0.9rem;">
            <thead>
              <tr>
                <th>æœŸæ•¸</th>
                <th>ç­–ç•¥</th>
                <th>å‘½ä¸­æ•¸</th>
              </tr>
            </thead>
            <tbody id="backtestTable"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <!-- ================= æ–°å¢ Panel D çµæŸ ================= -->

  <div class="footer">
    <p>âš ï¸ å…è²¬è²æ˜ï¼šæœ¬ç³»çµ±åƒ…ä¾›å¨›æ¨‚åƒè€ƒ</p>
  </div>
</div>

<script>
/* ===== åŸå§‹ JS é‚è¼¯å®Œå…¨æœªä¿®æ”¹ ===== */
let data = [];
let analysisCache = null;

/* ï¼ˆæ­¤è™•ä¿ç•™ä½ åŸæœ¬æ‰€æœ‰ functionï¼šrunAnalysisã€runVerifyã€generatePredictionâ€¦ï¼‰ */

/* ================= æ–°å¢ï¼šå›æ¸¬å¤–æ›æ¨¡çµ„ï¼ˆä¸å‹•åŸé‚è¼¯ï¼‰ ================= */

// ç­–ç•¥åŒ…è£ï¼ˆç›´æ¥å‘¼å«æ—¢æœ‰ generatePredictionï¼‰
function strategy_original() {
  return generatePrediction();
}

// å°ç…§çµ„ï¼šç´”éš¨æ©Ÿ
function strategy_random() {
  const s = new Set();
  while (s.size < 5) s.add(Math.floor(Math.random() * 39) + 1);
  return Array.from(s).sort((a,b)=>a-b);
}

const strategies = {
  "åŸå§‹ç­–ç•¥": strategy_original,
  "éš¨æ©Ÿå°ç…§": strategy_random
};

function runBacktest() {
  if (data.length < 10) {
    alert("è³‡æ–™ä¸è¶³ï¼Œç„¡æ³•å›æ¸¬");
    return;
  }

  document.getElementById("loadingBacktest").style.display = "block";
  document.getElementById("panelBacktest").style.display = "none";

  setTimeout(() => {
    const logs = [];
    const summary = {};

    Object.keys(strategies).forEach(k => {
      summary[k] = { total: 0, count: 0 };
    });

    for (let i = 5; i < data.length; i++) {
      const actual = data[i].numbers;
      const slice = data.slice(0, i);
      const backup = data;
      data = slice;

      Object.entries(strategies).forEach(([name, fn]) => {
        const pred = fn();
        const hit = pred.filter(n => actual.includes(n)).length;
        logs.push({ issue: i + 1, name, hit });
        summary[name].total += hit;
        summary[name].count++;
      });

      data = backup;
    }

    renderBacktest(logs, summary);

    document.getElementById("loadingBacktest").style.display = "none";
    document.getElementById("panelBacktest").style.display = "block";
  }, 100);
}

function renderBacktest(logs, summary) {
  const tbody = document.getElementById("backtestTable");
  tbody.innerHTML = "";

  logs.forEach(l => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${l.issue}</td><td>${l.name}</td><td>${l.hit}</td>`;
    tbody.appendChild(tr);
  });

  const box = document.getElementById("backtestSummary");
  box.innerHTML = "";
  Object.entries(summary).forEach(([k,v]) => {
    box.innerHTML += `<p><strong>${k}</strong>ï½œå¹³å‡å‘½ä¸­ ${(v.total/v.count).toFixed(2)}</p>`;
  });
}
/* ================= æ–°å¢çµæŸ ================= */
</script>

</body>
</html>
