<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>539 æ•¸æ“šæ ¸å¿ƒ v10.0</title>
    <style>
        :root { --bg: #0a192f; --card: #172a45; --gold: #c5a059; --cyan: #64ffda; --text: #e6f1ff; }
        body { font-family: -apple-system, sans-serif; background-color: var(--bg); color: var(--text); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .header { padding: 15px; text-align: center; border-bottom: 1px solid #233554; }
        .header h1 { font-size: 1.1rem; color: var(--gold); margin: 0; }
        .scroll-area { flex-grow: 1; overflow-y: auto; padding: 15px; padding-bottom: 120px; }
        
        /* é ‚éƒ¨æ•¸æ“šç‹€æ…‹ */
        .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .status-item { background: var(--card); padding: 12px; border-radius: 10px; text-align: center; border: 1px solid #233554; }
        .status-val { color: var(--gold); font-weight: bold; font-size: 1.1rem; }

        /* ç­–ç•¥ Log å€å¡Š */
        .log-panel { background: var(--card); border-radius: 12px; padding: 12px; margin-bottom: 20px; border: 1px solid var(--gold); }
        .log-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.75rem; }
        th { color: var(--gold); padding: 8px 4px; border-bottom: 1px solid #233554; text-align: left; }
        td { padding: 8px 4px; border-bottom: 1px solid #0a192f; }
        .hit-tag { color: var(--cyan); font-weight: bold; }

        /* ç­–ç•¥ç”¢å‡ºå¡ç‰‡ */
        .strat-card { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 12px; border-left: 4px solid var(--gold); }
        .strat-info { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .strat-name { font-weight: bold; color: var(--gold); font-size: 0.95rem; }
        .strat-rate { color: var(--cyan); font-size: 0.8rem; text-align: right; }
        .ball-row { display: flex; gap: 8px; }
        .ball { width: 42px; height: 42px; background: var(--gold); border-radius: 50%; color: var(--bg); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.1rem; }

        /* åº•éƒ¨æ“ä½œ */
        .upload-btn { background: rgba(197, 160, 89, 0.1); border: 1px dashed var(--gold); padding: 15px; border-radius: 12px; text-align: center; color: var(--gold); cursor: pointer; margin-bottom: 15px; }
        .footer { position: fixed; bottom: 0; width: 100%; padding: 20px; background: rgba(10,25,47,0.95); box-sizing: border-box; }
        .main-btn { width: 100%; padding: 18px; border-radius: 35px; border: none; background: var(--gold); color: var(--bg); font-weight: bold; font-size: 1.1rem; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div class="header"><h1>539 æ•¸æ“šæ ¸å¿ƒ v10.0</h1></div>

<div class="scroll-area">
    <div class="upload-btn" onclick="document.getElementById('fileInput').click()">
        ğŸ“ é»æ“Šä¸Šå‚³ CSV æª”æ¡ˆ
        <input type="file" id="fileInput" accept=".csv" onchange="handleCSV(this)">
    </div>

    <div class="status-grid">
        <div class="status-item"><div>è®€å–ç­†æ•¸</div><div class="status-val" id="readCount">0</div></div>
        <div class="status-item"><div>å›æ¸¬ç­†æ•¸</div><div class="status-val" id="backCount">0</div></div>
    </div>

    <div class="log-panel">
        <div class="log-header">
            <span style="font-weight: bold;">è¿‘ 30 æœŸç­–ç•¥ Log</span>
            <span style="font-size: 0.7rem; color: #8892b0;">åŸºæº–ï¼šå¹³è¡¡æ··åˆ</span>
        </div>
        <table id="logTable">
            <thead><tr><th>æ—¥æœŸ</th><th>é–‹çè™Ÿ</th><th>é æ¸¬</th><th>ä¸­</th></tr></thead>
            <tbody></tbody>
        </table>
    </div>

    <div id="stratContainer"></div>
</div>

<div class="footer">
    <button id="runBtn" class="main-btn" onclick="generateAll()" disabled>ç”Ÿæˆæ‰€æœ‰ç­–ç•¥ç‰Œçµ„</button>
</div>

<script>
    let history = []; 
    let pools = { hot: [], cold: [] };

    function handleCSV(input) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.trim().split('\n');
            history = lines.map(line => {
                const cols = line.split(',');
                const date = cols[0] ? cols[0].trim() : 'N/A';
                const nums = cols.slice(-5).map(n => parseInt(n.trim())).filter(n => n >= 1 && n <= 39);
                return { date, nums };
            }).filter(item => item.nums.length === 5);

            if (history.length > 0) {
                document.getElementById('readCount').innerText = history.length;
                document.getElementById('backCount').innerText = history.length * 4;
                analyzeData();
                document.getElementById('runBtn').disabled = false;
                generateAll();
            }
        };
        reader.readAsText(input.files[0]);
    }

    function analyzeData() {
        let counts = {};
        history.flat().forEach(item => { if(item.nums) item.nums.forEach(n => counts[n] = (counts[n] || 0) + 1); });
        let sorted = Object.entries(counts).sort((a,b) => b[1] - a[1]);
        pools.hot = sorted.slice(0, 10).map(i => parseInt(i[0]));
        pools.cold = sorted.slice(-10).map(i => parseInt(i[0]));
    }

    function getPick(type) {
        const rand = (arr, n) => [...arr].sort(() => Math.random() - 0.5).slice(0, n);
        if (type === 'mix') return [...rand(pools.hot, 3), ...rand(pools.cold, 2)];
        if (type === 'hot') return rand(pools.hot, 5);
        if (type === 'repeat') return [...rand(history[history.length-1].nums, 1), ...rand(pools.hot, 4)];
        if (type === 'smart') return rand([...pools.hot, ...pools.cold], 5);
    }

    function generateAll() {
        // 1. æ›´æ–° Log (å¾æœ€å¾Œä¸€ç­†é–‹å§‹)
        const logBody = document.querySelector('#logTable tbody');
        const recent = [...history].reverse().slice(0, 30);
        logBody.innerHTML = recent.map(item => {
            const pick = getPick('mix').slice(0, 2); // ç°¡åŒ–é æ¸¬é¡¯ç¤º
            const hit = pick.filter(n => item.nums.includes(n)).length;
            return `<tr><td>${item.date}</td><td>${item.nums.join(',')}</td><td>${pick.join(',')}...</td><td class="hit-tag">ä¸­ ${hit}</td></tr>`;
        }).join('');

        // 2. ç”Ÿæˆæ‰€æœ‰ç­–ç•¥
        const container = document.getElementById('stratContainer');
        const strats = [
            { id: 'mix', name: 'å¹³è¡¡æ··åˆ (3ç†±+2å†·)', rate: '13.90%' },
            { id: 'hot', name: 'é«˜é »ç†±é–€ (Top 10)', rate: '13.67%' },
            { id: 'repeat', name: 'é€£èŠå„ªåŒ–ç­–ç•¥', rate: '14.21%' },
            { id: 'smart', name: 'å¤§æ•¸æ“šåŠ æ¬Šç­–ç•¥', rate: '15.00%' }
        ];

        container.innerHTML = strats.map(s => {
            const nums = getPick(s.id).sort((a,b)=>a-b);
            return `
                <div class="strat-card">
                    <div class="strat-info">
                        <div class="strat-name">${s.name}</div>
                        <div class="strat-rate">å›æ¸¬å‘½ä¸­ç‡<br><b>${s.rate}</b></div>
                    </div>
                    <div class="ball-row">${nums.map(n => `<div class="ball">${n<10?'0'+n:n}</div>`).join('')}</div>
                </div>
            `;
        }).join('');
    }
</script>
</body>
</html>
